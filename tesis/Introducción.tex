\chapter{Introducción}
% Obtener una garantía de la solución es muy complejo (generalmente es estacionario y con puntos estacionarios).
La optimización de dos niveles, un área fundamental en la investigación operativa y la teoría de juegos, presenta desafíos significativos debido a su complejidad inherente. Este tipo de problemas se caracteriza por la interacción entre un líder y un seguidor, donde las decisiones del líder afectan las respuestas del seguidor. Uno de los aspectos más críticos de esta problemática es garantizar la existencia de soluciones óptimas, lo cual se ve complicado por la naturaleza no convexa del problema, incluso cuando las funciones y los conjuntos factibles son convexos. A menudo, los algoritmos utilizados en este contexto solo logran identificar puntos estacionarios o críticos, que no necesariamente representan soluciones locales o globales \cite{DempeyZemkoho2020}.

% Definición de problema binivel
%\begin{equation}
%    \begin{aligned}
%    \text{minimizar} & \quad F(x, y) \\
%    \text{sujeto a} & \quad G(x, y) \geq 0 \quad (\text{restricciones de desigualdad}) \\
%    & \quad H(x, y) = 0 \quad (\text{restricciones de igualdad}) \\
%    & \quad y \in S(x) = \arg \min_{y} \{ f(x, y) \mid V(x, y) \geq 0, U(x, y) = 0 \}.
%    \end{aligned}
% \end{equation}

\begin{table}[H]

    \[\begin{array}{l}
        \underset{\substack{x}}{\min} \quad F(x, y)\\
        s.a \left\{ \begin{array}{l}
            x \in T \\
             y \in S(x) = \arg  \underset{\substack{y}}{\min} \{ f(x, y) \quad s.a \quad y \in  H \}\\
            x,y \in M \\
        \end{array}\right.
    \end{array}\]\\


    \caption*{Problema de Optimización Binivel}
    \end{table}

% Explicar dimensiones 
Donde $x \in R^{n}$, $y \in R^{m}$, $F, f : \mathbb{R}^{n} \times \mathbb{R}^{m} \to \mathbb{R}$,  $T , f :\mathbb{R}^{n} \to \mathbb{R}$, 
$f, f : \mathbb{R}^{n} \times \mathbb{R}^{m} \to \mathbb{R} $, $H , f: \mathbb{R}^{m} \to \mathbb{R}$, $M , f : f : \mathbb{R}^{n} \times \mathbb{R}^{m} \to \mathbb{R}$


% Aplicaciones 
Esta es una herramienta fundamental para modelar y analizar mercados eléctricos complejos, ofreciendo una perspectiva única sobre las interacciones estratégicas entre diversos agentes económicos.
% Mercado Eléctrico
% Nash equilibrium in a pay-as-bid electricity market Part 2 - best response of a producer Didier
En el trabajo de \cite{Aussel2017NashEI}, se profundiza en el análisis de mercados de electricidad de pago por oferta, explorando cómo un productor puede ajustar su estrategia considerando las acciones de sus competidores. El estudio destaca la aplicación de conceptos de \textbf{equilibrio de Nash} y técnicas de mejor respuesta, proporcionando una metodología sofisticada para optimizar la participación de un productor en el mercado.
% Deregulated electricity markets with thermal losses and production bounds: models and optimality conditions
Continuando con esta línea de investigación, \cite{Aussel2016DeregulatedEM} desarrollaron un modelo innovador que aborda los mercados de electricidad desregulados. Su enfoque se distingue por incorporar restricciones de producción y pérdidas térmicas, lo que permite una modelización más precisa y realista. Mediante el uso de modelos binivel, los investigadores pueden explorar escenarios más complejos y representativos del funcionamiento real de los mercados energéticos.
% Electricity spot market with transmission losses
Además en otros trabajos se tienen en cuenta en los modelos las pérdidas de transmisión como en  \cite{Aussel2013ElectricitySM}, donde esta contribución mejora significativamente la representación del sistema eléctrico, permitiendo un análisis más profundo del equilibrio estratégico mediante técnicas de \textbf{optimización}. Al considerar las pérdidas de transmisión, el modelo captura aspectos fundamentales de la distribución y comercialización de energía que anteriormente pasaban desapercibidos.

% Machine Learning
También tiene aplicaciones fundamentales en la selección de hiperparámetros en aprendizaje automático, como lo demuestra el trabajo de \cite{DempeyZemkoho2020ML}. El capítulo 6 del libro aborda la optimización de hiperparámetros en problemas de clasificación y regresión, presentando algoritmos innovadores para manejar funciones objetivo no suaves y no convexas. La razón del uso de esta radica en su capacidad para minimizar errores en modelos complejos, mejorando así la precisión general del aprendizaje automático. Además, se implementan algoritmos especializados para abordar problemas no convexos.

% EPI
La optimización de dos niveles es una herramienta clave en el diseño y operación de redes industriales sostenibles. Ejemplos notables incluyen redes de agua industrial, 
% Water integration in eco-industrial parks using a multi-leader-follower approach
donde en los estudios de \cite{Ramos2016WaterII} se optimizan mediante juegos de múltiples líderes-seguidores, priorizando objetivos ambientales y económicos. Los resultados muestran que las empresas participantes lograron beneficios significativos en escenarios con formulaciones Karush-Kuhn-Tucker (KKT). 
El enfoque MLFG (Multi-Leader-Follower Game) se utiliza para analizar la optimización de redes de agua en Entornos Industriales Productivos (EIP). En este contexto, las empresas buscan minimizar costos mientras que una autoridad regula el consumo de agua dulce. Se comparan diferentes formulaciones y métodos de solución, mostrando que MLFG es más confiable que la optimización multiobjetivo en escenarios multi-criterio. Además, se destaca la influencia de la estructura del juego en la configuración óptima, sugiriendo la necesidad de un diseño óptimo para cada planta dentro del EIP \cite{Ramos2016WaterII}. 
Los enfoques SLMFG y MLSFG presentan variaciones en el rol de los participantes: en SLMFG, las empresas son seguidoras y la autoridad es líder, mientras que en MLSFG, ocurre lo contrario. Se resalta que el enfoque MLFG logra equilibrar objetivos económicos y ambientales, generando ahorros significativos mediante la reutilización de recursos. Los resultados indican una reducción en el consumo de agua fresca gracias a las estrategias implementadas, utilizando herramientas como GAMS para modelar los problemas de optimización \cite{Ramos2016WaterII}. 
% Utility network optimization in eco-industrial parks by a multi-leader follower game methodology
Además, \cite{Ramos2018UtilityNO} introducen el concepto de autoridad ambiental en el diseño de redes de servicios públicos, utilizando juegos de múltiples líderes-seguidores y reformulaciones KKT. 
% Bi-level optimal low-carbon economic dispatch for an industrial park with consideration of multi-energy price incentive
En el ámbito del despacho energético bajo restricciones de carbono, \cite{Gu2020BilevelOL} modela incentivos de precios de energía en un parque industrial, demostrando que un enfoque binivel puede simultáneamente mejorar el impacto ambiental y los beneficios económicos, utilizando un procedimiento iterativo primal-dual

% SLSF 
%A subsidy policy to managing hazmat risk in railroad transportation network
Además investigaciones como las de \cite{Bhavsar2021ASP} sobre la aplicación de una política de subsidios para gestionar el riesgo de materiales peligrosos en una red de transporte ferroviario. En este modelo, el gobierno actúa como líder, ofreciendo subsidios para incentivar al operador ferroviario (el seguidor) a usar rutas alternativas que eviten los enlaces de alto riesgo en la red, utilizando el enfoque Single Leader Single Follower (SLSF). Los autores utilizan una reformulación de Karush-Kuhn-Tucker (KKT) para resolver el problema y aplican su método a un caso real en los Estados Unidos. Se demuestra que incluso subsidios modestos pueden resultar en una reducción significativa del riesgo.


% Bilevel Difíciles
% NP-Hard
% The polynomial hierarchy and a simple model for competitive analysis
% Some properties of the bilevel programming problem
Dado que los problemas de optimización de ese tipo son inherentemente difíciles de resolver debido a su naturaleza \textbf{NP-hard} \cite{Jeroslow1985ThePHNP,jonathan_f__bard_1991NP}
% Sigma P2Hard
% Libro Dempe
% Tesis doctoral Cerulli
o incluso $\Sigma P2-hard$ \cite{phdthesisCerulli,DempeyZemkoho2020},
se han desarrollado diversos enfoques para abordar su complejidad computacional. Entre los métodos exactos más utilizados se encuentran las reformulaciones basadas en las condiciones KKT, que permiten transformar el problema binivel en un problema mononivel resoluble mediante técnicas tradicionales de programación matemática. Sin embargo, estos enfoques suelen ser computacionalmente intensivos para problemas de gran escala \cite{phdthesisCerulli}.
%A Review on Bilevel Optimization: From Classical to Evolutionary Approaches and Applications
En paralelo, los algoritmos metaheurísticos, como los evolutivos, han ganado relevancia al proporcionar aproximaciones eficientes en casos no lineales o no convexos, donde las soluciones exactas son inalcanzables en tiempos razonables \cite{Sinha2017ARO}.
% Dividir en subproblemas y resolver iterativamente
% Collection of Test Problems for Constrained Global Optimization Algorithms
Otro enfoque destacado es el uso de métodos de descomposición, los cuales dividen el problema en subproblemas más manejables que pueden resolverse iterativamente \cite{Floudas1990ACO}.

% An SOS1-based approach for solving MPECs with a natural gas market application
Estas técnicas son particularmente útiles en aplicaciones prácticas, como los mercados de energía o los modelos de sostenibilidad \cite{SadddiquiNaturalGasSOS1}.
% Libro Dempe
A pesar de estos avances, existen desafíos abiertos. La escalabilidad sigue siendo un problema crítico, ya que el crecimiento exponencial de las opciones en problemas de gran tamaño limita la aplicabilidad de los métodos exactos \cite{DempeyZemkoho2020}. Asimismo, los problemas no convexos carecen de garantías de convergencia hacia el óptimo global, lo que los hace especialmente difíciles de abordar. Finalmente, la incorporación de incertidumbre en los modelos agrega una capa adicional de complejidad, lo que demanda nuevos enfoques híbridos que combinen algoritmos exactos y heurísticos para mejorar la eficiencia computacional sin sacrificar la calidad de las soluciones \cite{phdthesisCerulli,Sinha2017ARO}. Estos avances y desafíos reflejan la importancia de diseñar algoritmos personalizados que aprovechen las estructuras particulares de cada problema binivel. Las aplicaciones industriales, como el diseño de redes ecoindustriales y la gestión de mercados energéticos, destacan la necesidad de enfoques que equilibren precisión y tiempo de cálculo, haciendo de la optimización de dos niveles un área de investigación activa con un impacto significativo en la práctica.

%Aclarar que la interaccion jerarquica es compleja
En otras palabras, el problema de optimización binivel se centra en que el líder (nivel superior) debe tomar decisiones ($x$) que optimicen su objetivo $F(x, y)$, anticipando que el seguidor (nivel inferior) responderá de manera óptima con respecto a su propio objetivo $f(x, y)$, dado el valor de $x$ elegido por el líder. Esta interacción jerárquica entre ambos niveles añade una gran complejidad al problema en comparación con los problemas de optimización de un solo nivel.

% DIFERENCIA OPTIMISTA PESIMISTA
% Decir que en el libro de Dempe se hablan de estos dos enfoques
El concepto mismo de solución del problema bi-nivel es complejo. La decisión del líder es solo respecto a un grupo de variables, mientras que las otras influyen en la función objetivo, pero no son decisión de él. Si para un mismo valor de las variables del líder el problema del seguidor tiene diferentes soluciones óptimas, el valor de la función objetivo del líder no estará determinado, sino que depende de cuál de los óptimos escogió el otro agente. De ahí que se consideran dos enfoques principales: el optimista y el pesimista. En el enfoque optimista, se asume que el seguidor, que actúa en el nivel inferior, elegirá la solución más favorable para el líder, quien toma decisiones en el nivel superior. Este es considerado más tratable y, en ciertas situaciones favorables, puede simplificarse a un problema convexo. Además, en el contexto de múltiples objetivos, el enfoque optimista permite alcanzar el mejor frente de Pareto posible \cite{DempeyZemkoho2020}.

Por otro lado, el enfoque pesimista asume que el seguidor seleccionará la opción menos favorable para el líder entre las soluciones óptimas disponibles, el cual es más complejo de resolver y puede incluso no tener solución. A menudo, se requieren reformulaciones para abordar estos problemas, lo que lo convierte en un reto teórico y computacional significativo. Y en situaciones de múltiples objetivos, conduce al peor frente de Pareto posible \cite{Sinha2017ARO}.

Es relevante destacar que la mayoría de la literatura se centra en el enfoque optimista debido a su mayor facilidad de tratamiento. Sin embargo, el otro también tiene su utilidad, especialmente en la modelación de situaciones donde se considera la aversión al riesgo \cite{DempeyZemkoho2020}. En este contexto, los términos ''líder'' y ''seguidor'' se utilizan para describir los roles en el modelo a optimizar; el líder toma decisiones considerando las posibles reacciones del seguidor, quien a su vez reacciona seleccionando su mejor opción \cite{Sinha2017ARO}.

% Sobre Valor extremal KKT y algoritmos 
Para obtener las condiciones de optimalidad y los algoritmos de solución de los modelos binivel se reportan dos enfoques fundamentales. En \cite{DempeyZemkoho2020} se usa la función valor extremal. 
%Explicacion sobre que va el valor extremal
Esto significa que para todo valor de $x$, se considera la minimización de la función objetivo del líder en el conjunto dado por las restricciones de ambos individuos y la condición de que la función objetivo del seguidor es menor o igual que el valor más pequeño que alcanza en el conjunto de soluciones factibles del seguidor.
% Hablar sobre el enfoque KKT 
% Hablar sobre las particularidades de cuando es condicion necesaria y suficiente
Las condiciones KKT son una herramienta clave en la reformulación de problemas de optimización, particularmente cuando el problema de nivel inferior es convexo. 
% Condiciones necesarias y suficientes dictadas por el kkt
Estas condiciones son necesarias bajo regularidad del conjunto de soluciones factibles  y suficientes en problemas convexos 
como se establece en la literatura sobre programación no lineal.
 
% Al realizar el kkt en el level inferior se transforma a un MPEC
En \cite{Caselli2024BilevelOW,DempeyZemkoho2020,phdthesisCerulli} se habla de  sustituir el problema del nivel inferior por la condicion de KKT permite transformar problemas de optimización binivel en programas matemáticos con restricciones de equilibrio (MPEC), facilitando así su resolución.

% Flegel Kanzow Sobre MPECs y los ptos estacionarios
%En el contexto de los MPEC, en \cite{Flegel2003AFJ} se exponen varios tipos de puntos estacionarios que son cruciales para analizar la optimalidad. Un punto \textbf{débilmente estacionario} es aquel que satisface las condiciones básicas de equilibrio, siendo una condición necesaria pero no suficiente para la optimalidad local. La \textbf{C-estacionariedad} es una condición más fuerte, que además requiere que el producto de ciertos multiplicadores de Lagrange sea no negativo en el conjunto degenerado. A su vez, la \textbf{M-estacionariedad} es aún más restrictiva, ya que exige condiciones específicas sobre los multiplicadores en el conjunto degenerado (que o bien ambos sean positivos, o su producto sea cero). El artículo también introduce el concepto de \textbf{A-estacionariedad}, que surge del enfoque de Fritz John, donde se requiere que al menos uno de los multiplicadores sea no negativo en el conjunto degenerado. Finalmente, un punto es \textbf{fuertemente estacionario} si ambos multiplicadores son no negativos en el conjunto degenerado, siendo esta la condición más restrictiva y que se da bajo ciertas condiciones como MPEC-LICQ o MPEC-SMFCQ. Por ello, estas condiciones forman una jerarquía donde la M-estacionariedad implica la C-estacionariedad y esta a su vez, implica la estacionariedad débil, siendo la estacionariedad fuerte la más restrictiva de todas. \cite{Flegel2003AFJ}.

% Metodos matematicos que se utilizan KKT y branch and bround
Los algoritmos que se basan en las condiciones KKT incluyen una variedad de métodos, como técnicas de branch-and-bound y métodos de suavizado, ver \cite{DempeyZemkoho2020}. 
% Hablar sobre el Suavizado KKT y Del SQP ademas de que el KKT se extiende a algoritmos evolutivos
%TODO: Change
Estos algoritmos son utilizados para resolver problemas complejos de optimización que involucran restricciones. Por ejemplo, en \cite{DempeyZemkoho2020} se discute el uso de un método de suavizado junto con las condiciones KKT para abordar problemas relacionados con la optimización de hiperparámetros. Además, se menciona que los algoritmos SQP (Sequential Quadratic Programming) también se fundamentan en las condiciones KKT para resolver problemas suaves con restricciones. Donde enuncian que versatilidad del método KKT se extiende incluso a algoritmos evolutivos. Este hecho demuestra su versatilidad diversas áreas de la optimización.

% Que son no convexos por las transformaciones
Los problemas de optimización de dos niveles son inherentemente no convexos, lo que implica que los métodos de optimización convexa no son directamente aplicables. Esta no convexidad puede llevar a soluciones subóptimas y a dificultades para encontrar una solución global. Aunque en muchos casos las funciones y conjuntos factibles pueden ser convexos, la estructura general del problema sigue siendo no convexa.

%La dificultad para encontrar soluciones globales se ve exacerbada por la tendencia de los métodos de búsqueda local a quedar atrapados en óptimos locales. Por ello, se han desarrollado métodos de búsqueda global que consideran la estructura específica de los problemas de optimización de dos niveles. Estos enfoques suelen incluir fases tanto de búsqueda local como global, utilizando condiciones de optimalidad global para mejorar la efectividad del proceso \cite{DempeyZemkoho2020}.

%Además, para abordar la no unicidad de las soluciones y mejorar la estabilidad del sistema, se emplean métodos de regularización. Estos pueden implicar la regularización de la función objetivo del seguidor o del conjunto de respuestas óptimas del mismo \cite{DempeyZemkoho2020}.

En resumen, obtener garantías sobre soluciones en problemas de optimización de dos niveles es un desafío complejo debido a su no convexidad inherente, las dificultades para escapar de óptimos locales y la posible falta de unicidad y estabilidad en las soluciones. Los algoritmos frecuentemente dependen de puntos estacionarios, que no siempre corresponden a las soluciones óptimas deseadas. Por lo tanto, es crucial desarrollar métodos especializados que aborden estos problemas y permitan encontrar soluciones globales o aproximaciones adecuadas \cite{DempeyZemkoho2020}.

% Se añadio la genericidad
% Paper de gema sobte  los ptos estacionarios
En este contexto, se ha estudiado la estructura genérica de los problemas de complementariedad (MPCC) que surgen del enfoque KKT y Fritz-John (FJ) aplicado a un problema de dos niveles. Se ha demostrado que, para una clase amplia de estos, la condición de que independencia lineal (MPCC-LICQ) se cumple en todos los puntos factibles. Sin embargo, las condiciones de complementariedad estricta (MPCC-SC) y las condiciones de segundo orden (MPCC-SOC) pueden fallar en puntos críticos (estacionarios), incluso en situaciones genéricas \cite{Allende2012SolvingBP}. Esta situación complica aún más la obtención de garantías sobre la solución.

Es importante señalar que existen casos singulares donde los puntos estacionarios pueden ser problemáticos, especialmente cuando el multiplicador (\(\alpha\)) asociado a la condicion de KKT del problema de nivel inferior es igual a cero. En tales circunstancias, la condición MPCC-SC puede no cumplirse, lo que podría llevar a que el método KKT no funcione adecuadamente \cite{Allende2012SolvingBP}.

% Qué se va a hacer en la tesis
Basándose en la caracterización de los diferentes tipos de puntos estacionarios establecida por \cite{Flegel2003AFJ}, esta tesis propone desarrollar un generador de problemas que, dado un punto estacionario conocido y un conjunto de funciones que definen un problema de dos niveles, agregarles fucniones polinomicales de primer o segundo grado de forma tal que el punto inicial dado sea un punto critico del problema creado. 
Este generador facilitará el estudio del comportamiento de algoritmos conocidos en problemas con al menos un punto estacionario conocido.
El usuario además podrá decidir si quiere un punto crático con multiplicadores arbitrarios o si $\alpha = \vec{0}$, lográndose estudiar las clases de puntos críticos que aparecen en el caso genérico, o sea en un clase amplia y significativa de problemas

%NOTA:
% Clase significativa y amplia:
% Es que todo problema es límite de problemas de la clase,
% y si un problema está en la clase,
% para toda perturbación de clase C3 suficientemente pequeña,
% el problema perturbado sigue estando en la clase.


% Explicación 
% 2do cap
La tesis está compuesta de 3 capítulos, luego del capítulo de introducción, por un segundo capítulo 
que contiene la notación que se empleará, se define el problema de dos niveles con un líder y un seguidor, y se explica la teoría matemática para su transformación en un problema MPEC, así como los algoritmos de Julia que se utilizarán en ella.
% 3ero
En el tercer capítulo se explicará la implementación algorítmica propuesta anteriormente y su correcta utilización. 
% 4to
En el cuarto capítulo se analizarán los resultados obtenidos por el algoritmo propuesto y su comparación con algoritmos implementados en el entorno Julia.
% Siguiente
Finalmente, se presentarán las conclusiones y recomendaciones del trabajo realizado.